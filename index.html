<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cold Email Generator - AI-Powered Email Writer</title>
    <meta name="description" content="Generate personalized cold emails that get responses. AI-powered, free, and private.">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: system-ui, -apple-system, sans-serif;
            background: linear-gradient(to bottom right, #0f172a, #1e293b);
            min-height: 100vh;
            padding: 24px;
            color: white;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 32px;
        }

        h1 {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 8px;
        }

        h1 span {
            color: #34d399;
        }

        .tagline {
            color: #94a3b8;
        }

        /* Auth Bar */
        .auth-bar {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            gap: 12px;
            margin-bottom: 24px;
            padding: 12px 16px;
            background: #1e293b;
            border-radius: 12px;
        }

        .auth-bar .user-email {
            color: #94a3b8;
            font-size: 14px;
        }

        .auth-bar .badge {
            background: #34d399;
            color: #0f172a;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
        }

        .auth-bar .badge.free {
            background: #64748b;
            color: white;
        }

        .btn-small {
            padding: 8px 16px;
            border-radius: 8px;
            border: none;
            font-size: 14px;
            cursor: pointer;
            font-weight: 500;
        }

        .btn-login {
            background: #34d399;
            color: #0f172a;
        }

        .btn-logout {
            background: #475569;
            color: white;
        }

        .btn-upgrade {
            background: linear-gradient(to right, #f59e0b, #ef4444);
            color: white;
        }

        /* Auth Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal {
            background: #1e293b;
            padding: 32px;
            border-radius: 16px;
            width: 100%;
            max-width: 400px;
        }

        .modal h2 {
            margin-bottom: 24px;
            text-align: center;
        }

        .modal input {
            width: 100%;
            padding: 12px 16px;
            margin-bottom: 12px;
            border-radius: 8px;
            border: 1px solid #475569;
            background: #0f172a;
            color: white;
            font-size: 14px;
        }

        .modal button {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: none;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 12px;
        }

        .modal .btn-primary {
            background: #34d399;
            color: #0f172a;
        }

        .modal .btn-secondary {
            background: transparent;
            color: #94a3b8;
            border: 1px solid #475569;
        }

        .modal .switch-text {
            text-align: center;
            color: #94a3b8;
            font-size: 14px;
        }

        .modal .switch-text a {
            color: #34d399;
            cursor: pointer;
        }

        .usage-info {
            background: #0f172a;
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 24px;
            text-align: center;
            font-size: 14px;
            color: #94a3b8;
        }

        .usage-info strong {
            color: #34d399;
        }

        /* Cards */
        .card {
            background: #1e293b;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            border: 1px solid #334155;
        }

        label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            color: #34d399;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .label-optional {
            color: #64748b;
            font-weight: normal;
            text-transform: none;
        }

        input, textarea, select {
            width: 100%;
            padding: 12px 16px;
            margin-bottom: 16px;
            border-radius: 8px;
            border: 1px solid #475569;
            background: #0f172a;
            color: white;
            font-size: 14px;
            font-family: inherit;
        }

        textarea {
            resize: none;
            min-height: 80px;
        }

        .btn-generate {
            width: 100%;
            padding: 14px;
            background: linear-gradient(to right, #10b981, #059669);
            border: none;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            margin-bottom: 12px;
        }

        .btn-generate:disabled {
            background: #475569;
            cursor: not-allowed;
        }

        .btn-secondary-big {
            width: 100%;
            padding: 14px;
            background: transparent;
            border: 1px solid #475569;
            border-radius: 12px;
            color: #94a3b8;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
        }

        .output-box {
            background: #0f172a;
            border-radius: 12px;
            padding: 16px;
            min-height: 200px;
            border: 1px solid #334155;
        }

        .output-placeholder {
            color: #64748b;
            text-align: center;
            padding: 40px;
        }

        .output-text {
            color: #e2e8f0;
            white-space: pre-wrap;
            font-size: 14px;
            line-height: 1.6;
        }

        .output-actions {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        footer {
            text-align: center;
            margin-top: 32px;
            color: #64748b;
            font-size: 14px;
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Auth Bar -->
        <div class="auth-bar">
            <div id="loggedOut">
                <button class="btn-small btn-login" onclick="showAuthModal('login')">ë¡œê·¸ì¸</button>
                <button class="btn-small btn-logout" onclick="showAuthModal('signup')">íšŒì›ê°€ì…</button>
            </div>
            <div id="loggedIn" class="hidden" style="display: flex; align-items: center; gap: 12px;">
                <span class="user-email" id="userEmail"></span>
                <span class="badge free" id="userBadge">FREE</span>
                <button class="btn-small btn-upgrade" id="upgradeBtn" onclick="upgrade()">Pro ì—…ê·¸ë ˆì´ë“œ</button>
                <button class="btn-small btn-logout" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
            </div>
        </div>

        <header>
            <h1>Cold Email <span>Generator</span></h1>
            <p class="tagline">Generate personalized cold emails that get responses</p>
        </header>

        <!-- Usage Info -->
        <div class="usage-info" id="usageInfo">
            ì˜¤ëŠ˜ ì‚¬ìš©: <strong><span id="usageCount">0</span> / <span id="usageLimit">3</span></strong> íšŒ
        </div>

        <!-- Main Content -->
        <div id="mainContent">
            <div class="card">
                <label>About You</label>
                <input type="text" id="myName" placeholder="Your name">
                <input type="text" id="myRole" placeholder="Your role">
                <input type="text" id="myCompany" placeholder="Your company">

                <label>About Recipient</label>
                <input type="text" id="recipientName" placeholder="Recipient's name">
                <input type="text" id="recipientRole" placeholder="Their role">
                <input type="text" id="recipientCompany" placeholder="Their company">

                <label>Purpose</label>
                <textarea id="purpose" placeholder="What do you want to achieve?"></textarea>

                <label>Tone & Style <span class="label-optional">(optional)</span></label>
                <input type="text" id="toneStyle" placeholder="e.g. Friendly but professional, under 100 words">

                <label>Output Language</label>
                <select id="outputLanguage">
                    <option value="English">English</option>
                    <option value="í•œêµ­ì–´">í•œêµ­ì–´</option>
                    <option value="æ—¥æœ¬èª">æ—¥æœ¬èª</option>
                    <option value="ä¸­æ–‡">ä¸­æ–‡</option>
                    <option value="EspaÃ±ol">EspaÃ±ol</option>
                </select>

                <button class="btn-generate" id="generateBtn" onclick="generateEmail()">
                    âœ¨ Generate Email
                </button>
            </div>

            <div class="card">
                <div class="output-actions hidden" id="outputActions">
                    <button class="btn-small btn-logout" onclick="copyEmail()">ğŸ“‹ Copy</button>
                    <button class="btn-small btn-logout" onclick="clearOutput()">ğŸ—‘ï¸ Clear</button>
                </div>
                <div class="output-box">
                    <div id="outputPlaceholder" class="output-placeholder">
                        Your generated email will appear here
                    </div>
                    <div id="outputText" class="output-text hidden"></div>
                </div>
            </div>
        </div>

        <footer>
            <p>Free Â· No tracking Â· No storage</p>
        </footer>
    </div>

    <!-- Auth Modal -->
    <div class="modal-overlay" id="authModal">
        <div class="modal">
            <h2 id="modalTitle">ë¡œê·¸ì¸</h2>
            <input type="email" id="authEmail" placeholder="ì´ë©”ì¼">
            <input type="password" id="authPassword" placeholder="ë¹„ë°€ë²ˆí˜¸">
            <button class="btn-primary" id="authSubmit" onclick="submitAuth()">ë¡œê·¸ì¸</button>
            <button class="btn-secondary" onclick="closeAuthModal()">ì·¨ì†Œ</button>
            <p class="switch-text" id="switchText">
                ê³„ì •ì´ ì—†ìœ¼ì‹ ê°€ìš”? <a onclick="switchAuthMode()">íšŒì›ê°€ì…</a>
            </p>
        </div>
    </div>

    <script>
        // Supabase ì„¤ì • - ì—¬ê¸°ì— ë„¤ ì •ë³´ ì…ë ¥!
        const SUPABASE_URL = 'https://mmghgqfumrgtqarmmukq.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_Tw0qZmsdwQ5hQWu6gR5aYA_JjhGU8Ou';
        const UPGRADE_URL = 'https://alltools.lemonsqueezy.com/checkout/buy/d3d1de76-2b95-45cb-8b13-4acf2fc8ad1a'; // ê²°ì œ ë§í¬

        const client = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        let currentUser = null;
        let isPro = false;
        let authMode = 'login';
        let todayUsage = 0;
        const FREE_LIMIT = 3;

        // í˜ì´ì§€ ë¡œë“œì‹œ
        window.onload = async function() {
            const { data: { user } } = await client.auth.getUser();
            if (user) {
                currentUser = user;
                await checkProStatus();
                updateUI();
            }
            loadUsage();
        }

        // Pro ìƒíƒœ ì²´í¬
        async function checkProStatus() {
            if (!currentUser) return;
            
            const { data, error } = await client
                .from('subscribers')
                .select('status')
                .eq('email', currentUser.email)
                .single();
            
            isPro = data?.status === 'active';
        }

        // UI ì—…ë°ì´íŠ¸
        function updateUI() {
            const loggedOut = document.getElementById('loggedOut');
            const loggedIn = document.getElementById('loggedIn');
            const userEmail = document.getElementById('userEmail');
            const userBadge = document.getElementById('userBadge');
            const upgradeBtn = document.getElementById('upgradeBtn');
            const usageLimit = document.getElementById('usageLimit');

            if (currentUser) {
                loggedOut.classList.add('hidden');
                loggedIn.classList.remove('hidden');
                userEmail.textContent = currentUser.email;
                
                if (isPro) {
                    userBadge.textContent = 'PRO';
                    userBadge.classList.remove('free');
                    upgradeBtn.classList.add('hidden');
                    usageLimit.textContent = 'âˆ';
                } else {
                    userBadge.textContent = 'FREE';
                    userBadge.classList.add('free');
                    upgradeBtn.classList.remove('hidden');
                    usageLimit.textContent = FREE_LIMIT;
                }
            } else {
                loggedOut.classList.remove('hidden');
                loggedIn.classList.add('hidden');
            }
            
            document.getElementById('usageCount').textContent = todayUsage;
        }

        // ì‚¬ìš©ëŸ‰ ë¡œë“œ (localStorage)
        function loadUsage() {
            const today = new Date().toDateString();
            const saved = localStorage.getItem('emailGenUsage');
            
            if (saved) {
                const data = JSON.parse(saved);
                if (data.date === today) {
                    todayUsage = data.count;
                } else {
                    todayUsage = 0;
                }
            }
            updateUI();
        }

        // ì‚¬ìš©ëŸ‰ ì €ì¥
        function saveUsage() {
            const today = new Date().toDateString();
            localStorage.setItem('emailGenUsage', JSON.stringify({
                date: today,
                count: todayUsage
            }));
        }

        // Auth Modal
        function showAuthModal(mode) {
            authMode = mode;
            document.getElementById('authModal').classList.add('show');
            document.getElementById('modalTitle').textContent = mode === 'login' ? 'ë¡œê·¸ì¸' : 'íšŒì›ê°€ì…';
            document.getElementById('authSubmit').textContent = mode === 'login' ? 'ë¡œê·¸ì¸' : 'íšŒì›ê°€ì…';
            document.getElementById('switchText').innerHTML = mode === 'login' 
                ? 'ê³„ì •ì´ ì—†ìœ¼ì‹ ê°€ìš”? <a onclick="switchAuthMode()">íšŒì›ê°€ì…</a>'
                : 'ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”? <a onclick="switchAuthMode()">ë¡œê·¸ì¸</a>';
        }

        function closeAuthModal() {
            document.getElementById('authModal').classList.remove('show');
            document.getElementById('authEmail').value = '';
            document.getElementById('authPassword').value = '';
        }

        function switchAuthMode() {
            showAuthModal(authMode === 'login' ? 'signup' : 'login');
        }

        async function submitAuth() {
            const email = document.getElementById('authEmail').value;
            const password = document.getElementById('authPassword').value;

            if (!email || !password) {
                alert('ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }

            if (authMode === 'signup') {
                const { data, error } = await client.auth.signUp({ email, password });
                if (error) {
                    alert('íšŒì›ê°€ì… ì‹¤íŒ¨: ' + error.message);
                } else {
                    alert('íšŒì›ê°€ì… ì„±ê³µ!');
                    currentUser = data.user;
                    await checkProStatus();
                    updateUI();
                    closeAuthModal();
                }
            } else {
                const { data, error } = await client.auth.signInWithPassword({ email, password });
                if (error) {
                    alert('ë¡œê·¸ì¸ ì‹¤íŒ¨: ' + error.message);
                } else {
                    currentUser = data.user;
                    await checkProStatus();
                    updateUI();
                    closeAuthModal();
                }
            }
        }

        async function logout() {
            await client.auth.signOut();
            currentUser = null;
            isPro = false;
            updateUI();
        }

        function upgrade() {
            window.open(UPGRADE_URL, '_blank');
        }

        // ì´ë©”ì¼ ìƒì„±
        async function generateEmail() {
            // ë¡œê·¸ì¸ ì²´í¬
            if (!currentUser) {
                alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤');
                showAuthModal('login');
                return;
            }

            // ì‚¬ìš©ëŸ‰ ì²´í¬
            if (!isPro && todayUsage >= FREE_LIMIT) {
                alert('ì˜¤ëŠ˜ ë¬´ë£Œ ì‚¬ìš©ëŸ‰ì„ ëª¨ë‘ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤. Proë¡œ ì—…ê·¸ë ˆì´ë“œ í•˜ì„¸ìš”!');
                return;
            }

            const myName = document.getElementById('myName').value;
            const myRole = document.getElementById('myRole').value;
            const myCompany = document.getElementById('myCompany').value;
            const recipientName = document.getElementById('recipientName').value;
            const recipientRole = document.getElementById('recipientRole').value;
            const recipientCompany = document.getElementById('recipientCompany').value;
            const purpose = document.getElementById('purpose').value;
            const toneStyle = document.getElementById('toneStyle').value;
            const outputLanguage = document.getElementById('outputLanguage').value;

            const btn = document.getElementById('generateBtn');
            btn.disabled = true;
            btn.textContent = 'âœ¨ Generating...';

            const prompt = `Write a cold email:
Sender: ${myName}, ${myRole} at ${myCompany}
Recipient: ${recipientName}, ${recipientRole} at ${recipientCompany}
Purpose: ${purpose}
Tone: ${toneStyle || 'Professional'}
Language: ${outputLanguage}

Write a concise email with subject line.`;

            try {
                const response = await fetch('/api/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                       
                    },
                    body: JSON.stringify({
                        model: 'gpt-4o-mini',
                        messages: [
                            { role: 'system', content: 'You are an expert cold email copywriter.' },
                            { role: 'user', content: prompt }
                        ],
                        max_tokens: 500
                    })
                });

                const data = await response.json();
                
                if (data.error) {
                    alert('Error: ' + data.error.message);
                } else {
                    const email = data.choices[0].message.content;
                    document.getElementById('outputPlaceholder').classList.add('hidden');
                    document.getElementById('outputText').classList.remove('hidden');
                    document.getElementById('outputText').textContent = email;
                    document.getElementById('outputActions').classList.remove('hidden');

                    // ì‚¬ìš©ëŸ‰ ì¦ê°€
                    todayUsage++;
                    saveUsage();
                    updateUI();
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }

            btn.disabled = false;
            btn.textContent = 'âœ¨ Generate Email';
        }

        function copyEmail() {
            const text = document.getElementById('outputText').textContent;
            navigator.clipboard.writeText(text);
            alert('ë³µì‚¬ë¨!');
        }

        function clearOutput() {
            document.getElementById('outputPlaceholder').classList.remove('hidden');
            document.getElementById('outputText').classList.add('hidden');
            document.getElementById('outputActions').classList.add('hidden');
        }
    </script>
</body>
</html>
