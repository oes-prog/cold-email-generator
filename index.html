<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cold Email Generator - AI-Powered Email Writer</title>
    <meta name="description" content="Generate personalized cold emails that get responses. AI-powered, free, and private.">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: system-ui, -apple-system, sans-serif;
            background: linear-gradient(to bottom right, #0f172a, #1e293b);
            min-height: 100vh;
            padding: 24px;
            color: white;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 32px;
        }

        h1 {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 8px;
        }

        h1 span {
            color: #34d399;
        }

        .tagline {
            color: #94a3b8;
        }

        /* Auth Bar */
        .auth-bar {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            gap: 12px;
            margin-bottom: 24px;
            padding: 12px 16px;
            background: #1e293b;
            border-radius: 12px;
        }

        .auth-bar .user-email {
            color: #94a3b8;
            font-size: 14px;
        }

        .auth-bar .badge {
            background: #34d399;
            color: #0f172a;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
        }

        .auth-bar .badge.free {
            background: #64748b;
            color: white;
        }

        .btn-small {
            padding: 8px 16px;
            border-radius: 8px;
            border: none;
            font-size: 14px;
            cursor: pointer;
            font-weight: 500;
        }

        .btn-login {
            background: #34d399;
            color: #0f172a;
        }

        .btn-logout {
            background: #475569;
            color: white;
        }

        .btn-upgrade {
            background: linear-gradient(to right, #f59e0b, #ef4444);
            color: white;
        }

        /* Auth Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal {
            background: #1e293b;
            padding: 32px;
            border-radius: 16px;
            width: 100%;
            max-width: 400px;
        }

        .modal h2 {
            margin-bottom: 24px;
            text-align: center;
        }

        .modal input {
            width: 100%;
            padding: 12px 16px;
            margin-bottom: 12px;
            border-radius: 8px;
            border: 1px solid #475569;
            background: #0f172a;
            color: white;
            font-size: 14px;
        }

        .modal button {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: none;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 12px;
        }

        .modal .btn-primary {
            background: #34d399;
            color: #0f172a;
        }

        .modal .btn-secondary {
            background: transparent;
            color: #94a3b8;
            border: 1px solid #475569;
        }

        .modal .switch-text {
            text-align: center;
            color: #94a3b8;
            font-size: 14px;
        }

        .modal .switch-text a {
            color: #34d399;
            cursor: pointer;
        }

        .usage-info {
            background: #0f172a;
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 24px;
            text-align: center;
            font-size: 14px;
            color: #94a3b8;
        }

        .usage-info strong {
            color: #34d399;
        }

        /* Cards */
        .card {
            background: #1e293b;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            border: 1px solid #334155;
        }

        label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            color: #34d399;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .label-optional {
            color: #64748b;
            font-weight: normal;
            text-transform: none;
        }

        input, textarea, select {
            width: 100%;
            padding: 12px 16px;
            margin-bottom: 16px;
            border-radius: 8px;
            border: 1px solid #475569;
            background: #0f172a;
            color: white;
            font-size: 14px;
            font-family: inherit;
        }

        textarea {
            resize: none;
            min-height: 80px;
        }

        .btn-generate {
            width: 100%;
            padding: 14px;
            background: linear-gradient(to right, #10b981, #059669);
            border: none;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            margin-bottom: 12px;
        }

        .btn-generate:disabled {
            background: #475569;
            cursor: not-allowed;
        }

        .btn-secondary-big {
            width: 100%;
            padding: 14px;
            background: transparent;
            border: 1px solid #475569;
            border-radius: 12px;
            color: #94a3b8;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
        }

        .output-box {
            background: #0f172a;
            border-radius: 12px;
            padding: 16px;
            min-height: 200px;
            border: 1px solid #334155;
        }

        .output-placeholder {
            color: #64748b;
            text-align: center;
            padding: 40px;
        }

        .output-text {
            color: #e2e8f0;
            white-space: pre-wrap;
            font-size: 14px;
            line-height: 1.6;
        }

        .output-actions {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        footer {
            text-align: center;
            margin-top: 32px;
            color: #64748b;
            font-size: 14px;
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Auth Bar -->
        <div class="auth-bar">
            <div id="loggedOut">
                <button class="btn-small btn-login" onclick="showAuthModal('login')">Î°úÍ∑∏Ïù∏</button>
                <button class="btn-small btn-logout" onclick="showAuthModal('signup')">ÌöåÏõêÍ∞ÄÏûÖ</button>
            </div>
            <div id="loggedIn" class="hidden" style="display: flex; align-items: center; gap: 12px;">
                <span class="user-email" id="userEmail"></span>
                <span class="badge free" id="userBadge">FREE</span>
                <button class="btn-small btn-upgrade" id="upgradeBtn" onclick="upgrade()">Pro ÏóÖÍ∑∏Î†àÏù¥Îìú</button>
                <button class="btn-small btn-logout" onclick="logout()">Î°úÍ∑∏ÏïÑÏõÉ</button>
            </div>
        </div>

        <header>
            <h1>Cold Email <span>Generator</span></h1>
            <p class="tagline">Generate personalized cold emails that get responses</p>
        </header>

        <!-- Usage Info -->
        <div class="usage-info" id="usageInfo">
            Ïò§Îäò ÏÇ¨Ïö©: <strong><span id="usageCount">0</span> / <span id="usageLimit">3</span></strong> Ìöå
        </div>

        <!-- Main Content -->
        <div id="mainContent">
            <div class="card">
                <label>About You</label>
                <input type="text" id="myName" placeholder="Your name">
                <input type="text" id="myRole" placeholder="Your role">
                <input type="text" id="myCompany" placeholder="Your company">

                <label>About Recipient</label>
                <input type="text" id="recipientName" placeholder="Recipient's name">
                <input type="text" id="recipientRole" placeholder="Their role">
                <input type="text" id="recipientCompany" placeholder="Their company">

                <label>Purpose</label>
                <textarea id="purpose" placeholder="What do you want to achieve?"></textarea>

                <label>Tone & Style <span class="label-optional">(optional)</span></label>
                <input type="text" id="toneStyle" placeholder="e.g. Friendly but professional, under 100 words">

                <label>Output Language</label>
                <select id="outputLanguage">
                    <option value="English">English</option>
                    <option value="ÌïúÍµ≠Ïñ¥">ÌïúÍµ≠Ïñ¥</option>
                    <option value="Êó•Êú¨Ë™û">Êó•Êú¨Ë™û</option>
                    <option value="‰∏≠Êñá">‰∏≠Êñá</option>
                    <option value="Espa√±ol">Espa√±ol</option>
                </select>

                <button class="btn-generate" id="generateBtn" onclick="generateEmail()">
                    ‚ú® Generate Email
                </button>
            </div>

            <div class="card">
                <div class="output-actions hidden" id="outputActions">
                    <button class="btn-small btn-logout" onclick="copyEmail()">üìã Copy</button>
                    <button class="btn-small btn-logout" onclick="clearOutput()">üóëÔ∏è Clear</button>
                </div>
                <div class="output-box">
                    <div id="outputPlaceholder" class="output-placeholder">
                        Your generated email will appear here
                    </div>
                    <div id="outputText" class="output-text hidden"></div>
                </div>
            </div>
        </div>

        <footer>
            <p>Free ¬∑ No tracking ¬∑ No storage</p>
        </footer>
    </div>

    <!-- Auth Modal -->
    <div class="modal-overlay" id="authModal">
        <div class="modal">
            <h2 id="modalTitle">Î°úÍ∑∏Ïù∏</h2>
            <input type="email" id="authEmail" placeholder="Ïù¥Î©îÏùº">
            <input type="password" id="authPassword" placeholder="ÎπÑÎ∞ÄÎ≤àÌò∏">
            <button class="btn-primary" id="authSubmit" onclick="submitAuth()">Î°úÍ∑∏Ïù∏</button>
            <button class="btn-secondary" onclick="closeAuthModal()">Ï∑®ÏÜå</button>
            <p class="switch-text" id="switchText">
                Í≥ÑÏ†ïÏù¥ ÏóÜÏúºÏã†Í∞ÄÏöî? <a onclick="switchAuthMode()">ÌöåÏõêÍ∞ÄÏûÖ</a>
            </p>
        </div>
    </div>

    <script>
        // Supabase ÏÑ§Ï†ï - Ïó¨Í∏∞Ïóê ÎÑ§ Ï†ïÎ≥¥ ÏûÖÎ†•!
        const SUPABASE_URL = 'https://mmghgqfumrgtqarmmukq.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_Tw0qZmsdwQ5hQWu6gR5aYA_JjhGU8Ou';
        const OPENAI_API_KEY = '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'; // ÎÑ§ OpenAI ÌÇ§
        const UPGRADE_URL = 'https://alltools.lemonsqueezy.com/checkout/buy/d3d1de76-2b95-45cb-8b13-4acf2fc8ad1a'; // Í≤∞Ï†ú ÎßÅÌÅ¨

        const client = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        let currentUser = null;
        let isPro = false;
        let authMode = 'login';
        let todayUsage = 0;
        const FREE_LIMIT = 3;

        // ÌéòÏù¥ÏßÄ Î°úÎìúÏãú
        window.onload = async function() {
            const { data: { user } } = await client.auth.getUser();
            if (user) {
                currentUser = user;
                await checkProStatus();
                updateUI();
            }
            loadUsage();
        }

        // Pro ÏÉÅÌÉú Ï≤¥ÌÅ¨
        async function checkProStatus() {
            if (!currentUser) return;
            
            const { data, error } = await client
                .from('subscribers')
                .select('status')
                .eq('email', currentUser.email)
                .single();
            
            isPro = data?.status === 'active';
        }

        // UI ÏóÖÎç∞Ïù¥Ìä∏
        function updateUI() {
            const loggedOut = document.getElementById('loggedOut');
            const loggedIn = document.getElementById('loggedIn');
            const userEmail = document.getElementById('userEmail');
            const userBadge = document.getElementById('userBadge');
            const upgradeBtn = document.getElementById('upgradeBtn');
            const usageLimit = document.getElementById('usageLimit');

            if (currentUser) {
                loggedOut.classList.add('hidden');
                loggedIn.classList.remove('hidden');
                userEmail.textContent = currentUser.email;
                
                if (isPro) {
                    userBadge.textContent = 'PRO';
                    userBadge.classList.remove('free');
                    upgradeBtn.classList.add('hidden');
                    usageLimit.textContent = '‚àû';
                } else {
                    userBadge.textContent = 'FREE';
                    userBadge.classList.add('free');
                    upgradeBtn.classList.remove('hidden');
                    usageLimit.textContent = FREE_LIMIT;
                }
            } else {
                loggedOut.classList.remove('hidden');
                loggedIn.classList.add('hidden');
            }
            
            document.getElementById('usageCount').textContent = todayUsage;
        }

        // ÏÇ¨Ïö©Îüâ Î°úÎìú (localStorage)
        function loadUsage() {
            const today = new Date().toDateString();
            const saved = localStorage.getItem('emailGenUsage');
            
            if (saved) {
                const data = JSON.parse(saved);
                if (data.date === today) {
                    todayUsage = data.count;
                } else {
                    todayUsage = 0;
                }
            }
            updateUI();
        }

        // ÏÇ¨Ïö©Îüâ Ï†ÄÏû•
        function saveUsage() {
            const today = new Date().toDateString();
            localStorage.setItem('emailGenUsage', JSON.stringify({
                date: today,
                count: todayUsage
            }));
        }

        // Auth Modal
        function showAuthModal(mode) {
            authMode = mode;
            document.getElementById('authModal').classList.add('show');
            document.getElementById('modalTitle').textContent = mode === 'login' ? 'Î°úÍ∑∏Ïù∏' : 'ÌöåÏõêÍ∞ÄÏûÖ';
            document.getElementById('authSubmit').textContent = mode === 'login' ? 'Î°úÍ∑∏Ïù∏' : 'ÌöåÏõêÍ∞ÄÏûÖ';
            document.getElementById('switchText').innerHTML = mode === 'login' 
                ? 'Í≥ÑÏ†ïÏù¥ ÏóÜÏúºÏã†Í∞ÄÏöî? <a onclick="switchAuthMode()">ÌöåÏõêÍ∞ÄÏûÖ</a>'
                : 'Ïù¥ÎØ∏ Í≥ÑÏ†ïÏù¥ ÏûàÏúºÏã†Í∞ÄÏöî? <a onclick="switchAuthMode()">Î°úÍ∑∏Ïù∏</a>';
        }

        function closeAuthModal() {
            document.getElementById('authModal').classList.remove('show');
            document.getElementById('authEmail').value = '';
            document.getElementById('authPassword').value = '';
        }

        function switchAuthMode() {
            showAuthModal(authMode === 'login' ? 'signup' : 'login');
        }

        async function submitAuth() {
            const email = document.getElementById('authEmail').value;
            const password = document.getElementById('authPassword').value;

            if (!email || !password) {
                alert('Ïù¥Î©îÏùºÍ≥º ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî');
                return;
            }

            if (authMode === 'signup') {
                const { data, error } = await client.auth.signUp({ email, password });
                if (error) {
                    alert('ÌöåÏõêÍ∞ÄÏûÖ Ïã§Ìå®: ' + error.message);
                } else {
                    alert('ÌöåÏõêÍ∞ÄÏûÖ ÏÑ±Í≥µ!');
                    currentUser = data.user;
                    await checkProStatus();
                    updateUI();
                    closeAuthModal();
                }
            } else {
                const { data, error } = await client.auth.signInWithPassword({ email, password });
                if (error) {
                    alert('Î°úÍ∑∏Ïù∏ Ïã§Ìå®: ' + error.message);
                } else {
                    currentUser = data.user;
                    await checkProStatus();
                    updateUI();
                    closeAuthModal();
                }
            }
        }

        async function logout() {
            await client.auth.signOut();
            currentUser = null;
            isPro = false;
            updateUI();
        }

        function upgrade() {
            window.open(UPGRADE_URL, '_blank');
        }

        // Ïù¥Î©îÏùº ÏÉùÏÑ±
        async function generateEmail() {
            // Î°úÍ∑∏Ïù∏ Ï≤¥ÌÅ¨
            if (!currentUser) {
                alert('Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§');
                showAuthModal('login');
                return;
            }

            // ÏÇ¨Ïö©Îüâ Ï≤¥ÌÅ¨
            if (!isPro && todayUsage >= FREE_LIMIT) {
                alert('Ïò§Îäò Î¨¥Î£å ÏÇ¨Ïö©ÎüâÏùÑ Î™®Îëê ÏÇ¨Ïö©ÌñàÏäµÎãàÎã§. ProÎ°ú ÏóÖÍ∑∏Î†àÏù¥Îìú ÌïòÏÑ∏Ïöî!');
                return;
            }

            const myName = document.getElementById('myName').value;
            const myRole = document.getElementById('myRole').value;
            const myCompany = document.getElementById('myCompany').value;
            const recipientName = document.getElementById('recipientName').value;
            const recipientRole = document.getElementById('recipientRole').value;
            const recipientCompany = document.getElementById('recipientCompany').value;
            const purpose = document.getElementById('purpose').value;
            const toneStyle = document.getElementById('toneStyle').value;
            const outputLanguage = document.getElementById('outputLanguage').value;

            const btn = document.getElementById('generateBtn');
            btn.disabled = true;
            btn.textContent = '‚ú® Generating...';

            const prompt = `Write a cold email:
Sender: ${myName}, ${myRole} at ${myCompany}
Recipient: ${recipientName}, ${recipientRole} at ${recipientCompany}
Purpose: ${purpose}
Tone: ${toneStyle || 'Professional'}
Language: ${outputLanguage}

Write a concise email with subject line.`;

            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${OPENAI_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-4o-mini',
                        messages: [
                            { role: 'system', content: 'You are an expert cold email copywriter.' },
                            { role: 'user', content: prompt }
                        ],
                        max_tokens: 500
                    })
                });

                const data = await response.json();
                
                if (data.error) {
                    alert('Error: ' + data.error.message);
                } else {
                    const email = data.choices[0].message.content;
                    document.getElementById('outputPlaceholder').classList.add('hidden');
                    document.getElementById('outputText').classList.remove('hidden');
                    document.getElementById('outputText').textContent = email;
                    document.getElementById('outputActions').classList.remove('hidden');

                    // ÏÇ¨Ïö©Îüâ Ï¶ùÍ∞Ä
                    todayUsage++;
                    saveUsage();
                    updateUI();
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }

            btn.disabled = false;
            btn.textContent = '‚ú® Generate Email';
        }

        function copyEmail() {
            const text = document.getElementById('outputText').textContent;
            navigator.clipboard.writeText(text);
            alert('Î≥µÏÇ¨Îê®!');
        }

        function clearOutput() {
            document.getElementById('outputPlaceholder').classList.remove('hidden');
            document.getElementById('outputText').classList.add('hidden');
            document.getElementById('outputActions').classList.add('hidden');
        }
    </script>
</body>
</html>
